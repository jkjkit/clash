# Clash 配置模板
port: 7890
socks-port: 7891
allow-lan: true
mode: rule
log-level: info
ipv6: true
udp: true

unified-delay: true
geodata-mode: false
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 24
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome

external-controller: 0.0.0.0:9090

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true

dns:
  enable: true
  prefer-h3: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
  - "*.lan"
  - "*.local"
  - localhost.ptlogin2.qq.com
  - +.srv.nintendo.net
  - +.stun.playstation.net
  - +.msftconnecttest.com
  - +.msftncsi.com
  default-nameserver:
    - 223.5.5.5
    - 223.6.6.6
  nameserver:
    - https://223.5.5.5/dns-query
    - https://223.6.6.6/dns-query

# ======= 锚点定义 =======

#节点检测 [每24小时更新一次订阅节点，每 60 秒一次健康检查]
pr: &pr {type: http, interval: 86400, health-check: {enable: true, interval: 60, url: "http://www.gstatic.com/generate_204"}}

#故障转移 [每 10 秒一次惰性健康检查，时延超过 3 秒判定为失败，失败 3 次则自动触发健康检查]
failover: &failover {type: fallback, lazy: true, interval: 10, url: "http://www.gstatic.com/generate_204", timeout: 3000, max-failed-times: 3, hidden: true, include-all-providers: true}

#规则参数 [每天更新一次订阅规则，更新规则时使用Proxy策略]
RuleSet: &RuleSet {type: http, behavior: classical, interval: 86400, format: yaml, proxy: Proxy}

#节点过滤 []
Filter-HK: &Filter-HK '香港|HK|HongKong'
Filter-TW: &Filter-TW '台湾|TW|Taiwan'
Filter-US: &Filter-US '美国|US|United States|America'
Filter-UK: &Filter-UK '英国|UK|United Kingdom|England'
Filter-JP: &Filter-JP '日本|JP|Japan'
Filter-KR: &Filter-KR '韩国|KR|Korean'
Filter-SG: &Filter-SG '新加坡|SG|Singapore'
Filter-UN: &Filter-UN '^(?!.*(香港|HK|HongKong|台湾|TW|Taiwan|美国|US|United States|America|英国|UK|United Kingdom|England|日本|JP|Japan|韩国|KR|Korean|新加坡|SG|Singapore|家宽|专线)).*$'

# ======= 订阅节点 =======
proxy-providers:
  Sub:
    <<: *pr
    url: "订阅链接"
    path: ./profiles/proxies/subscription.yaml

# ======= 策略组 =======
proxy-groups:
  - {name: Proxy, type: select, proxies: [HK,TW,US,UK,JP,KR,SG,UN,Select,DIRECT]}
  - {name: Select, type: select, use: [Sub]}  
  - {name: HK, <<: *failover, filter: *Filter-HK}
  - {name: TW, <<: *failover, filter: *Filter-TW}
  - {name: US, <<: *failover, filter: *Filter-US}
  - {name: UK, <<: *failover, filter: *Filter-UK}  
  - {name: JP, <<: *failover, filter: *Filter-JP}
  - {name: KR, <<: *failover, filter: *Filter-KR}
  - {name: SG, <<: *failover, filter: *Filter-SG}  
  - {name: UN, <<: *failover, filter: *Filter-UN}

# ======= 规则集 =======
rule-providers:
#广告拦截
  reject:
    <<: *RuleSet
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./profiles/rules/reject.txt
#代理列表  
  proxy:
    <<: *RuleSet
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./profiles/rules/proxy.txt
#直连列表
  direct:
    <<: *RuleSet
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./profiles/rules/direct.txt
#大陆地址
  cncidr:
    <<: *RuleSet
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./profiles/rules/cncidr.txt
#软件列表
  applications:
    <<: *RuleSet
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./profiles/rules/applications.txt

# ======= 规则 =======
rules:
  - RULE-SET,reject,REJECT
  - RULE-SET,proxy,Proxy
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,applications,DIRECT
  - RULE-SET,direct,DIRECT  
  - GEOIP,CN,DIRECT
  - MATCH,Proxy
